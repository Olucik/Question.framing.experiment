# Install and load the package
#install.packages("VennDiagram")
library(VennDiagram)
library(dplyr)
library(grid)
library(gridExtra)
library(readxl)
library(tidyr)
library(car)
library(SnowballC)
library(boot)
library(pwr)
library(vtable)
#install.packages("occupationMeasurement")
library(occupationMeasurement)
#devtools::install_github("psyteachr/introdataviz")

# Data Annotations
# Due to confidentiality, actual open-ended responses cannot be publicly shared.
# Instead, we provide de-identified data with categorical and response-related information.

# Variables:

# userid: Anonymized unique identifier for each respondent
# sex: Gender of the respondent,"1" for male, "2" for female)
# age: Age of the respondent (numeric)
# firma: Company that administered the survey (Forsa or Bilendi)

# answer1.na: Indicates if the respondent answered the first question about job title or occupational task
#   - 1 = No answer provided (NA)
#   - 0 = Answer provided


# condition1: First experimental condition - respondents were asked about either job title or occupational task

# condition2: Second experimental condition - respondents described specific tasks and duties
#   - Responses were conditioned on whether the respondent saw an example of how to answer or not

#condition1.english - short descciption of the 1st condition "job title" or "job task" tupe of the question

#condition2.english - short description of the 2nd experimental condition "with example" or "without example" 

# char.count_answer1: Character count of response to question under condition1
# word.count_answer1: Word count of response to question under condition1

# char.count_answer2: Character count of response to question under condition2 (specific tasks and duties)
# word.count_answer2: Word count of response to question under condition2

#noun: binary variable, 1 mean a text answer to the condition 1 question included a noun
#verb:	binary variable, 1 mean a text answer to the condition 1 question included a verb
#adjective: binary variable, 1 mean a text answer to the condition 1 question included an adjective	
#stopwords: binary variable, 1 mean a text answer to the condition 1 question included a stop word
#ends with -mann, -frau, -er, -erin, -in, -eur, -e, -ist, -wirt	: binary variable, 1 mean a text answer to the condition 1 question included words with typical ending for occupational titles
#ends with -ung, -heit, -keit, -nis, -schaft: binary variable, 1 mean a text answer to the condition 1 question included a derived noun 

#confidence.occucode - a confidence score for each of the answers in the condition 1 generated by the OccuCode
#threshold.occucode	- a binary variable, 1 means "easy to code answer", a confidence score for that answer was equal or above 0.535. 0 means a hard to code answer "a confidence score for that answer was below 0.535

#confidence.cascot	a confidence score for each of the answers in the condition 1 generated by CASCOT
#threshold.cascot	- a binary variable, 1 means "easy to code answer", a confidence score for that answer was equal or above 64. 0 means a hard to code answer "a confidence score for that answer was below 64
#
#type.na variable shows which answers under the condition 2 were assigned as Hard non response or soft nonresponse (HNR and SNR)
#cond2.noun	numerical variable, shows how many nouns were used to answer condition 2 question
#cond2.verb	numerical variable, shows how many verbs were used to answer condition 2 question
#cond2.adjective	numerical variable, shows how many adjectives were used to answer condition 2 question
##cond2.stopwords	numerical variable, shows how many stop words were used to answer condition 2 question
#cond2.ends with -mann, -frau, -er, -erin, -in, -eur, -e, -ist, -wirt	numerical variable, shows how many nouns indicating occupational title were used to answer condition 2 question
#cond2.ends with -ung, -heit, -keit, -nis, -schaft numerical variable, shows how many Derived nouns were used to answer condition 2 question


dataset_complete <- read_excel("data/dataset.complete.xlsx")

df_filtered<- dataset.complete %>%
  filter(!is.na(char.count_answer1))


################################################################ 
### statistics for table 1 (Descriptive statistics) 

forsa<- dataset.complete %>%
  filter(firma=="forsa")
mean(forsa$char.count_answer1[forsa$condition1=="Welche berufliche\nTätigkeit üben Sie\nderzeit hauptsächlich aus?"], na.rm=TRUE)
mean(forsa$char.count_answer1[forsa$condition1=="Welche Berufsbezeichnung\nhat Ihre gegenwärtige\nTätigkeit?"], na.rm=TRUE)
median(forsa$char.count_answer1[forsa$condition1=="Welche berufliche\nTätigkeit üben Sie\nderzeit hauptsächlich aus?"], na.rm=TRUE)
median(forsa$char.count_answer1[forsa$condition1=="Welche Berufsbezeichnung\nhat Ihre gegenwärtige\nTätigkeit?"], na.rm=TRUE)

mean(forsa$word.count_answer1[forsa$condition1=="Welche berufliche\nTätigkeit üben Sie\nderzeit hauptsächlich aus?"], na.rm=TRUE)
mean(forsa$word.count_answer1[forsa$condition1=="Welche Berufsbezeichnung\nhat Ihre gegenwärtige\nTätigkeit?"], na.rm=TRUE)
median(forsa$word.count_answer1[forsa$condition1=="Welche berufliche\nTätigkeit üben Sie\nderzeit hauptsächlich aus?"], na.rm=TRUE)
median(forsa$word.count_answer1[forsa$condition1=="Welche Berufsbezeichnung\nhat Ihre gegenwärtige\nTätigkeit?"], na.rm=TRUE)

bilendi<- dataset.complete %>%
  filter(firma=="bilendi")

mean(bilendi$char.count_answer1[bilendi$condition1=="Welche berufliche\nTätigkeit üben Sie\nderzeit hauptsächlich aus?"], na.rm=TRUE)
mean(bilendi$char.count_answer1[bilendi$condition1=="Welche Berufsbezeichnung\nhat Ihre gegenwärtige\nTätigkeit?"], na.rm=TRUE)
median(bilendi$char.count_answer1[bilendi$condition1=="Welche berufliche\nTätigkeit üben Sie\nderzeit hauptsächlich aus?"], na.rm=TRUE)
median(bilendi$char.count_answer1[bilendi$condition1=="Welche Berufsbezeichnung\nhat Ihre gegenwärtige\nTätigkeit?"], na.rm=TRUE)


mean(bilendi$word.count_answer1[bilendi$condition1=="Welche berufliche\nTätigkeit üben Sie\nderzeit hauptsächlich aus?"], na.rm=TRUE)
mean(bilendi$word.count_answer1[bilendi$condition1=="Welche Berufsbezeichnung\nhat Ihre gegenwärtige\nTätigkeit?"], na.rm=TRUE)
median(bilendi$word.count_answer1[bilendi$condition1=="Welche berufliche\nTätigkeit üben Sie\nderzeit hauptsächlich aus?"], na.rm=TRUE)
median(bilendi$word.count_answer1[bilendi$condition1=="Welche Berufsbezeichnung\nhat Ihre gegenwärtige\nTätigkeit?"], na.rm=TRUE)


#### Soft nonresponse 
SNR<- dataset.complete %>%
  filter(answer1.na==0)
SNR <- SNR %>%
  mutate(chi = ifelse(is.na(char.count_answer1), 1,0))
table(SNR$chi)

data_bilendi <- SNR %>% filter(firma == "bilendi")
data_forsa <- SNR %>% filter(firma == "forsa")
table(data_bilendi$condition1.english, data_bilendi$chi)
table(data_forsa$condition1.english, data_forsa$chi)


#### Hard nonresponse
HNR<- dataset.complete %>%
  filter(answer1.na==1)
HNR <- HNR %>%
  mutate(chi = ifelse(is.na(char.count_answer1), 1,0))
table(HNR$chi)

data_bilendi <- HNR %>% filter(firma == "bilendi")
data_forsa <- HNR %>% filter(firma == "forsa")
table(data_bilendi$condition1.english, data_bilendi$chi)
table(data_forsa$condition1.english, data_forsa$chi)

#valid responses 

data_bilendi <- dataset.complete %>%
  filter(!is.na(word.count_answer1) & firma == "bilendi")
table(data_bilendi$condition1.english)

data_forsa <- dataset.complete %>%
  filter(!is.na(word.count_answer1) & firma == "forsa")
table(data_forsa$condition1.english)


########################################## ##################### ##################### ##################### 
##################### descriptive statistics for table 2:


data_bilendi31 <- dataset.complete %>% filter(firma == "bilendi", condition2.english == "example")
data_bilendi32 <- dataset.complete %>% filter(firma == "bilendi", condition2.english == "no example")

mean(data_bilendi31$char.count_answer2, na.rm=TRUE)
mean(data_bilendi32$char.count_answer2, na.rm=TRUE)
median(data_bilendi31$char.count_answer2, na.rm=TRUE)
median(data_bilendi32$char.count_answer2, na.rm=TRUE)

mean(data_bilendi31$word.count_answer2, na.rm=TRUE)
mean(data_bilendi32$word.count_answer2, na.rm=TRUE)
median(data_bilendi31$word.count_answer2, na.rm=TRUE)
median(data_bilendi32$word.count_answer2, na.rm=TRUE)


data_forsa31 <- dataset.complete %>% filter(firma == "forsa", condition2.english == "example")
data_forsa32 <- dataset.complete %>% filter(firma == "forsa", condition2.english == "no example")
mean(data_forsa31$char.count_answer2, na.rm=TRUE)
mean(data_forsa32$char.count_answer2, na.rm=TRUE)
median(data_forsa31$char.count_answer2, na.rm=TRUE)
median(data_forsa32$char.count_answer2, na.rm=TRUE)

mean(data_forsa31$word.count_answer2, na.rm=TRUE)
mean(data_forsa32$word.count_answer2, na.rm=TRUE)
median(data_forsa31$word.count_answer2, na.rm=TRUE)
median(data_forsa32$word.count_answer2, na.rm=TRUE)


#### Soft nonresponse 

SNR<- dataset.complete


data_bilendi <- SNR %>% filter(firma == "bilendi")
data_forsa <- SNR %>% filter(firma == "forsa")
table(data_bilendi$condition2.english, data_bilendi$type.na)
table(data_forsa$condition2.english, data_forsa$type.na)

data_bilendi <- dataset.complete %>%
  filter(!is.na(word.count_answer2) & firma == "bilendi")
table(data_bilendi$condition2.english)

data_forsa <- dataset.complete %>%
  filter(!is.na(word.count_answer2) & firma == "forsa")
table(data_forsa$condition2.english)


################################################################ 
#### Analysis and dataviz for Figure 2

q1.type.words <- dataset.complete %>%
  dplyr::filter(char.count_answer1 !="NA") %>%
  dplyr::select(firma, condition1.english, noun:`ends with -ung, -heit, -keit, -nis, -schaft`)

data_long <- pivot_longer(q1.type.words, cols = c(-firma, -condition1.english), names_to = "Variable", values_to = "Value")
data_long <- data_long %>%
  mutate(Variable = case_when(
    Variable == "ends with -mann, -frau, -er, -erin, -in, -eur, -e, -ist, -wirt" ~ "OccupationTitle",
    Variable == "ends with -ung, -heit, -keit, -nis, -schaft" ~ "DerivedNouns",
    Variable == "noun" ~ "Nouns",
    Variable == "stop words" ~ "StopWords",
    Variable == "verb" ~ "Verbs",
    Variable == "adjective" ~ "Adjectives",
    TRUE ~ Variable
  )) %>%
  mutate(Variable = factor(Variable, levels = rev(c("Nouns", "OccupationTitle", "DerivedNouns", "Adjectives", "StopWords", "Verbs"))))


 data_bilendi1 <- q1.type.words %>% filter(firma == "bilendi", condition1.english == "job task")
 data_bilendi2 <- q1.type.words %>% filter(firma == "bilendi", condition1.english == "job title")
# # 
 data_forsa1 <- q1.type.words %>% filter(firma == "forsa", condition1.english == "job task")
 data_forsa2 <- q1.type.words %>% filter(firma == "forsa", condition1.english == "job title")

data_long_summary <- data_long %>%
  group_by(Variable, condition1.english, firma) %>%
  summarise(count = sum(Value, na.rm = TRUE), .groups = 'drop') %>%
  mutate(
    total = case_when(
      firma == "forsa" & condition1.english == "job task" ~ 188,
      firma == "forsa" & condition1.english == "job title" ~ 146,
      firma == "bilendi" & condition1.english == "job task" ~ 224,
      TRUE ~ 215
    )
  ) %>%
  ungroup() %>%
  mutate(share = count / total * 100) %>%
  mutate(condition1.english= ifelse(condition1.english=="job task", "Occupational Task", "Job Title"))

#data_long_summary$Variable <- factor(data_long_summary$Variable, levels = data_long_summary$Variable[order(data_long_summary$share, decreasing = TRUE)])

figure2<- ggplot(data = data_long_summary, aes(x = Variable, y = share, fill = condition1.english)) +
  geom_bar(position = 'dodge', stat='identity', alpha=0.8) +
  geom_text(aes(label=round(share, 0), color = condition1.english), position=position_dodge(width=0.9), hjust=-0.25, size=4) +
  scale_fill_manual(values = c("#00429d", "#ff9408"), 
                    name = "Question type") +       
  scale_color_manual(values = c("#00429d", "#ff9408"), 
                     guide = "none") +
  theme_minimal() +
  coord_flip() +
  labs(x = "Type of the answer",
       y = "Percentage") +
  facet_wrap(~factor(firma, 
                     levels = c("forsa", "bilendi"), 
                     labels = c("Forsa", "Bilendi")), 
             nrow = 1) +
  scale_y_continuous(limits = c(0, 113))+
  theme(axis.text.x = element_text(size = 10),  
        axis.text.y = element_text(size = 14), 
        strip.text = element_text(size = 14),
        legend.text = element_text(size = 12),  
        legend.title = element_text(size = 14)) 


ggsave(file="output/figure2.jpeg", 
       plot=figure2, 
       height = 5, width = 8, dpi = 300)

ggsave(file="output/figure2.svg", 
       plot=figure2, 
       height = 5, width = 8, dpi = 300)

#calculate the Fisher's test for difference between categories

data_long_summary.test.forsa <- data_long %>%
  group_by(Variable, condition1.english, firma) %>%
  summarise(count = sum(Value, na.rm = TRUE), .groups = 'drop') %>%
  filter(firma=="forsa")

contingency_table <- xtabs(count ~ Variable + condition1.english, data = data_long_summary.test.forsa)
fisher.test(contingency_table)

data_long_summary.test.bilendi <- data_long %>%
  group_by(Variable, condition1.english, firma) %>%
  summarise(count = sum(Value, na.rm = TRUE), .groups = 'drop') %>%
  filter(firma=="bilendi")

contingency_table <- xtabs(count ~ Variable + condition1.english, data = data_long_summary.test.bilendi)
fisher.test(contingency_table)

################################################################ 
############# Analysis and dataviz Figure 3 lengh difference



data_bilendi1 <- df_filtered %>% filter(firma == "bilendi", condition1.english == "job task")
data_bilendi2 <- df_filtered %>% filter(firma == "bilendi", condition1.english == "job title")

data_forsa1 <- df_filtered %>% filter(firma == "forsa", condition1.english == "job task")
data_forsa2 <- df_filtered %>% filter(firma == "forsa", condition1.english == "job title")

result.task<-rbind(data_bilendi1, data_forsa1)
result.title<-rbind(data_bilendi2, data_forsa2)
result.bilendi<-rbind(data_bilendi1, data_bilendi2)
result.forsa<-rbind(data_forsa1, data_forsa2)

# Mann-Whitney U test and Levene Test
test_result.bilendi<- leveneTest(char.count_answer1~ condition1.english, result.bilendi)
test_result.forsa<- leveneTest(char.count_answer1~ condition1.english, result.forsa)
MWU.bilendi<-wilcox.test(data_bilendi2$char.count_answer1, data_bilendi1$char.count_answer1,alternative = "two.sided")
MWU.forsa<-wilcox.test(data_forsa2$char.count_answer1, data_forsa1$char.count_answer1,alternative = "two.sided")
test_result.bilendi
test_result.forsa

# Create a summary message for the annotation
summary_message.bil.mwu <- paste("MWU Test p-value =", sprintf(".%03d", round(MWU.bilendi$p.value , 3) * 1000))
summary_message.forsa.mwu <- paste("MWU Test p-value =", sprintf(".%03d", round(MWU.forsa$p.value , 3) * 1000))
summary_message.bilendi <- paste("Levene's Test p-value =", sprintf(".%03d", round(test_result.bilendi$`Pr(>F)`[1], 3) * 1000))
summary_message.forsa <- paste("Levene's Test p-value =", sprintf(".%03d", round(test_result.forsa$`Pr(>F)`[1], 3) * 1000))


#dataviz
rain_height <- .1

df_filtered1<- df_filtered %>%
  mutate(condition1.english= ifelse(condition1.english=="job task", "Occupational Task", "Job Title"))
p<-ggplot(df_filtered1, aes(x = "", y = char.count_answer1, fill = condition1.english)) +
  introdataviz::geom_flat_violin(trim=FALSE, alpha = 0.4,
                                 position = position_nudge(x = rain_height+.05)) +
  geom_point(aes(colour = condition1.english), size = 0.5, alpha = .2, show.legend = FALSE, 
             position = position_jitter(width = rain_height, height = 0)) +
  geom_boxplot(width = rain_height, alpha = 0.2, show.legend = FALSE, 
               outlier.shape = NA,
               position = position_nudge(x = -rain_height*2)) +
  facet_wrap(~factor(firma, 
                     levels = c("forsa", "bilendi"), 
                     labels = c("Forsa", "Bilendi")), 
             nrow = 2) +
  stat_summary(fun.data = mean_cl_normal, mapping = aes(color = condition1.english), show.legend = FALSE,
               position = position_nudge(x = rain_height * 3)) +
  scale_x_discrete(name = "", expand = c(rain_height*3, 0, 0, 0.7)) +
  coord_flip() +
  scale_fill_manual(values = c("#00429d", "#ff9408"), 
                    name = "Question type")+
  scale_color_manual(values = c("#00429d", "#ff9408"))+
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
        legend.position = c(0.8, 0.5),
        legend.background = element_rect(fill = "white", color = "white"))+
  labs(y = "Length of the answer (number of characters)")+
  theme(axis.text.x = element_text(size = 10),  
        axis.text.y = element_text(size = 14),
        strip.text = element_text(size = 14),
        legend.text = element_text(size = 12),  
        legend.title = element_text(size = 14)) 


y_position.task <- 51
y_position.title <- 51
y_position.bilendi <- 51
y_position.forsa <- 51

annotation_data1 <- data.frame(firma = c("forsa", "bilendi"), 
                               x = c(1.15, 1.15), # Choose an appropriate x position 
                               y = c(y_position.bilendi, y_position.forsa), 
                               label = c(summary_message.forsa,summary_message.bilendi))

annotation_data2 <- data.frame(firma = c("forsa", "bilendi"), 
                               x = c(1.02, 1.02), # Choose an appropriate x position 
                               y = c(y_position.task, y_position.title), 
                               label = c(summary_message.bil.mwu,summary_message.forsa.mwu))
p.length <- p + 
  geom_text(data = annotation_data1, aes(label = label, x = x, y = y), 
            inherit.aes = FALSE, 
            vjust = -1, size = 4) +
  geom_text(data = annotation_data2, aes(label = label, x = x, y = y), 
            inherit.aes = FALSE, 
            vjust = -1, size = 4)
p.length

ggsave(file="output/figure3.jpeg", 
       plot=p.length, 
       height = 5, width = 7, dpi = 300)

ggsave(file="output/figure3.svg", 
       plot=p.length, 
       height = 5, width = 8, dpi = 300)


############################ TTR ratio
#THis part of the code relies on calculating actual tockens, and can not be executed without verbatims, that we can not include in a public dataset due to privacy
# We however provide results of the analysis where possible

german_stopwords <- c(stopwords::stopwords("german"), "ich", "bin", "Ich", "arbeite","&","sowie","etc", "unsere","An","dienen", "eigenen",
                      "b", "z","Des","unseren","unserem", "ca", "Es", "ganze", "wer","Der", "In", "de", "Auch", "Vor", "ab","-","Zu", "Wir","and", "bzw", 
                      "")
calculate_ttr <- function(sample_data) {
  sample_data <- tolower(sample_data)
  sample_data <- gsub("[[:punct:]0-9]+", "", sample_data)
  tokens <- unlist(strsplit(sample_data, "\\s+"))
  tokens <- tokens[tokens != "" & !(tokens %in% german_stopwords)]
  stemmed_tokens <- wordStem(tokens, language = "german")
  unique_words <- length(unique(stemmed_tokens))
  total_words <- length(stemmed_tokens)
  return(unique_words / total_words)
}


calculate_ttr(df_filtered$answer.condition1[df_filtered$firma=="forsa" & df_filtered$condition1.english=="job task"])
calculate_ttr(df_filtered$answer.condition1[df_filtered$firma=="forsa" & df_filtered$condition1.english=="job title"])
calculate_ttr(df_filtered$answer.condition1[df_filtered$firma=="bilendi" & df_filtered$condition1.english=="job task"])
calculate_ttr(df_filtered$answer.condition1[df_filtered$firma=="bilendi" & df_filtered$condition1.english=="job title"])


# Function to calculate the difference in TTR between two groups
ttr_difference <- function(data, indices) {
  group1_indices <- indices[data$group[indices] == 1]
  group2_indices <- indices[data$group[indices] == 2]
  group1_sample <- data$word_list[group1_indices]
  group2_sample <- data$word_list[group2_indices]
  group1_text <- paste(group1_sample, collapse = " ")
  group2_text <- paste(group2_sample, collapse = " ")
  #print(group1_text)
  #print(group2_text)
  ttr1 <- calculate_ttr(group1_text)
  ttr2 <- calculate_ttr(group2_text)
  return(ttr2 - ttr1)
}

# Prepare and perform the bootstrap
perform_bootstrap <- function(df, firm_name) {
  group1_words <- df$answer.condition1[df$firma == firm_name & df$condition1.english == "job title"]
  group2_words <- df$answer.condition1[df$firma == firm_name & df$condition1.english == "job task"]
  all_words <- c(group1_words, group2_words)
  group_indicator <- c(rep(1, length(group1_words)), rep(2, length(group2_words)))
  data_frame <- data.frame(word_list = all_words, group = group_indicator)
  set.seed(123)  # For reproducibility
  boot_results <- boot(data_frame, statistic = ttr_difference, R = 1000, parallel = "no", stype = "i")
  return(boot_results)
}

bootstrap_results_forsa <- perform_bootstrap(df_filtered, "forsa")
bootstrap_results_forsa
# 
# ORDINARY NONPARAMETRIC BOOTSTRAP
# Call:
#   boot(data = data_frame, statistic = ttr_difference, R = 1000, 
#        stype = "i", parallel = "no")
# Bootstrap Statistics :
#   original     bias    std. error
# t1* -0.1057105 0.04831474  0.04665449

bootstrap_results_bilendi <- perform_bootstrap(df_filtered, "bilendi")
bootstrap_results_bilendi
# ORDINARY NONPARAMETRIC BOOTSTRAP
# Call:
#   boot(data = data_frame, statistic = ttr_difference, R = 1000, 
#        stype = "i", parallel = "no")
# Bootstrap Statistics :
#   original    bias    std. error
# t1* -0.0334257 0.0140183  0.04032012

# Extract the bootstrap estimates
bootstrap_estimates_forsa <- bootstrap_results_forsa$t
bootstrap_estimates_bilendi <- bootstrap_results_bilendi$t
# Calculate the confidence interval
boot.ci(bootstrap_results_forsa, type = "perc")
boot.ci(bootstrap_results_bilendi, type = "perc")
# Calculate 95% confidence intervals using the percentile method
ci_forsa <- boot.ci(bootstrap_results_forsa, type = "perc")
ci_bilendi <- boot.ci(bootstrap_results_bilendi, type = "perc")

# Extract lower and upper bounds
lower_ci_forsa <- ci_forsa$perc[4]
upper_ci_forsa <- ci_forsa$perc[5]
lower_ci_bilendi <- ci_bilendi$perc[4]
upper_ci_bilendi <- ci_bilendi$perc[5]


# Prepare data for plotting
data_plot <- data.frame(
  estimate = c(bootstrap_estimates_forsa, bootstrap_estimates_bilendi),
  firm = factor(rep(c("Forsa", "Bilendi"), each = 1000))
)

TTR.condition1<-ggplot(data_plot, aes(x = estimate, fill = firm)) +
  geom_histogram(binwidth = 0.003, color = "#828182", alpha=1) +
  # custom colours and theme
  scale_fill_manual(values = c("#E2B6CC", "#709A86"), 
                    name = "Agency")+
  scale_color_manual(values = c("#E2B6CC", "#709A86"))+
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
        legend.position = c(0.9, 0.4),
        legend.background = element_rect(fill = "white", color = "white"))+
  labs(y = "")+
  facet_wrap(~ firm, nrow=2) +
  geom_vline(data = data.frame(firm = "Forsa", xintercept = c(lower_ci_forsa, upper_ci_forsa)),
             aes(xintercept = xintercept), linetype = "dashed", color = "red") +
  geom_vline(data = data.frame(firm = "Bilendi", xintercept = c(lower_ci_bilendi, upper_ci_bilendi)),
             aes(xintercept = xintercept), linetype = "dashed", color = "red") +
  labs(title = "",
       x = "Bootstrapped difference in TTR between professional activity (Approach B) and job title (aprroach A) responses",
       y = "Frequency")+
  theme(axis.text.x = element_text(size = 8),  # Set the size for the x-axis labels
        axis.text.y = element_text(size = 8))  # S

ggsave(file="output/bootstrap.condition1.jpeg", 
       plot=TTR.condition1, 
       height = 5, width = 8, dpi = 300)

ggsave(file="output/bootstrap.condition1.svg", 
       plot=TTR.condition1, 
       height = 5, width = 8, dpi = 300)


######################################################################################################
# Table 3, codability of answers OccuCode

##### the get_job_suggestions is also calculating based on the verbatim answers. For the privacy reasons we already report the final result
#results<- get_job_suggestions(df_filtered$answer.condition1, num_suggestions = 1)
#with.suggestions<-cbind(df_filtered, results)

#dataset.complete$threshold.occucode<-ifelse(dataset.complete$confidence.occucode>=0.535,1,0)
dataset.occucode<- dataset.complete %>%
  filter(!is.na(char.count_answer1))

bilendy.sugg<- dataset.occucode %>%
  filter(firma=="bilendi") %>%
  select(confidence.occucode,threshold.occucode, condition1.english)

forsa.sugg<- dataset.occucode %>%
  filter(firma=="forsa") %>%
  select(confidence.occucode,threshold.occucode, condition1.english)


st(forsa.sugg, group = 'condition1.english', group.test = TRUE)
st(bilendy.sugg, group = 'condition1.english', group.test = TRUE)

#Threshold
threshold <- 0.535 

# Calculate the percentage of scores above the threshold
mean(forsa.sugg$confidence.occucode[forsa.sugg$condition1.english=="job task"] >= threshold) * 100
mean(forsa.sugg$confidence.occucode[forsa.sugg$condition1.english=="job title"] >= threshold) * 100
mean(bilendy.sugg$confidence.occucode[bilendy.sugg$condition1.english=="job task"] >= threshold) * 100
mean(bilendy.sugg$confidence.occucode[bilendy.sugg$condition1.english=="job title"] >= threshold) * 100

data_long_summary_test_forsa <- forsa.sugg %>%
  group_by(threshold.occucode, condition1.english) %>%
  summarise(count = n(), .groups = 'drop')


contingency_table <- xtabs(count ~ threshold.occucode + condition1.english, data = data_long_summary_test_forsa)
chi_square<-chisq.test(contingency_table)
chi_square
# Calculate Phi coefficient
phi <- sqrt(chi_square$statistic /nrow(forsa.sugg) )
phi
pwr_result <- pwr.chisq.test(w = phi,  # Effect size (Phi)
                             df = 1,   # Degrees of freedom (for a 2x2 table, df = 1)
                             sig.level = 0.05,  # Significance level
                             power = 0.8)  # Desired power (80%)

# Display the result
pwr_result

data_long_summary_test_bilendi <- bilendy.sugg %>%
  group_by(threshold.occucode, condition1.english) %>%
  summarise(count = n(), .groups = 'drop')


contingency_table <- xtabs(count ~ threshold.occucode + condition1.english, data = data_long_summary_test_bilendi)
chi_square<-chisq.test(contingency_table)
chi_square
# Calculate Phi coefficient
phi <- sqrt(chi_square$statistic /nrow(bilendy.sugg) )
phi
pwr_result <- pwr.chisq.test(w = phi,  # Effect size (Phi)
                             df = 1,   # Degrees of freedom (for a 2x2 table, df = 1)
                             sig.level = 0.05,  # Significance level
                             power = 0.8)  # Desired power (80%)

# Display the result
pwr_result


########################################## cascot sujjecstions
##### cascot confidence scores were calculated in a separate software CASCOT.
#the cascot threshold is 64
dataset.cascot<- dataset.complete %>%
  filter(!is.na(char.count_answer1))


bilendy.sugg<- dataset.cascot %>%
  filter(firma=="bilendi") %>%
  select(confidence.cascot,threshold.cascot, condition1.english)

forsa.sugg<- dataset.cascot %>%
  filter(firma=="forsa") %>%
  select(confidence.cascot,threshold.cascot, condition1.english)

st(bilendy.sugg, group = 'condition1.english', group.test = TRUE)
st(forsa.sugg, group = 'condition1.english', group.test = TRUE)


#Threshold
threshold <- 64 
mean(forsa.sugg$threshold.cascot[forsa.sugg$condition1.english=="job task"])

# Calculate the percentage of scores above the threshold
mean(forsa.sugg$confidence.cascot[forsa.sugg$condition1.english=="job task"] >= threshold) * 100
mean(forsa.sugg$confidence.cascot[forsa.sugg$condition1.english=="job title"] >= threshold) * 100
mean(bilendy.sugg$confidence.cascot[bilendy.sugg$condition1.english=="job task"] >= threshold) * 100
mean(bilendy.sugg$confidence.cascot[bilendy.sugg$condition1.english=="job title"] >= threshold) * 100



data_long_summary_test_forsa <- forsa.sugg %>%
  group_by(threshold.cascot, condition1.english) %>%
  summarise(count = n(), .groups = 'drop')


contingency_table <- xtabs(count ~ threshold.cascot + condition1.english, data = data_long_summary_test_forsa)
chi_square<-chisq.test(contingency_table)
chi_square
phi <- sqrt(chi_square$statistic /nrow(forsa.sugg) )
phi
# Calculate the required sample size
pwr_result <- pwr.chisq.test(w = phi,  # Effect size (Phi)
                             df = 1,   # Degrees of freedom (for a 2x2 table, df = 1)
                             sig.level = 0.05,  # Significance level
                             power = 0.8)  # Desired power (80%)

# Display the result
pwr_result

data_long_summary_test_bilendi <- bilendy.sugg %>%
  group_by(threshold.cascot, condition1.english) %>%
  summarise(count = n(), .groups = 'drop')

contingency_table <- xtabs(count ~ threshold.cascot + condition1.english, data = data_long_summary_test_bilendi)
chi_square<-chisq.test(contingency_table)
chi_square
phi <- sqrt(chi_square$statistic /nrow(bilendy.sugg) )
phi
# Calculate the required sample size
pwr_result <- pwr.chisq.test(w = phi,  # Effect size (Phi)
                             df = 1,   # Degrees of freedom (for a 2x2 table, df = 1)
                             sig.level = 0.05,  # Significance level
                             power = 0.8)  # Desired power (80%)

# Display the result
pwr_result


################################################################### figure 4

data_q2<-dataset.complete %>%
  filter(!is.na(char.count_answer2))


data_bilendi1 <- data_q2 %>% filter(firma == "bilendi", condition2.english == "example")
data_bilendi2 <- data_q2 %>% filter(firma == "bilendi", condition2.english == "no example")

data_forsa1 <- data_q2 %>% filter(firma == "forsa", condition2.english == "example")
data_forsa2 <- data_q2 %>% filter(firma == "forsa", condition2.english == "no example")

result.bilendi<-rbind(data_bilendi1, data_bilendi2)
result.forsa<-rbind(data_forsa1, data_forsa2)

# Mann-Whitney U test and Levene Test
test_result.bilendi<- leveneTest(char.count_answer2~ condition2.english, result.bilendi)
test_result.forsa<- leveneTest(char.count_answer2~ condition2.english, result.forsa)
MWU.bilendi<-wilcox.test(data_bilendi1$char.count_answer2, data_bilendi2$char.count_answer2,alternative = "greater")
MWU.forsa<-wilcox.test(data_forsa1$char.count_answer2, data_forsa2$char.count_answer2,alternative = "greater")
test_result.bilendi
test_result.forsa


# Create a summary message for the annotation
summary_message.bil.mwu <- paste("MWU Test p-value =", sprintf(".%03d", round(MWU.bilendi$p.value , 3) * 1000))
summary_message.forsa.mwu <- paste("MWU Test p-value =", sprintf(".%03d", round(MWU.forsa$p.value , 3) * 1000))
summary_message.bilendi4142 <- paste("Levene's Test p-value =", sprintf(".%03d", round(test_result.bilendi$`Pr(>F)`[1], 3) * 1000))
summary_message.forsa4142 <- paste("Levene's Test p-value =", sprintf(".%03d", round(test_result.forsa$`Pr(>F)`[1], 3) * 1000))


rain_height <- .1
#devtools::install_github("psyteachr/introdataviz")
p<-ggplot(data_q2, aes(x = "", y = char.count_answer2, fill = condition2.english)) +
  introdataviz::geom_flat_violin(trim=FALSE, alpha = 0.4,
                                 position = position_nudge(x = rain_height+.05)) +
  geom_point(aes(colour = condition2.english), size = 0.5, alpha = .2, show.legend = FALSE, 
             position = position_jitter(width = rain_height, height = 0)) +
  geom_boxplot(width = rain_height, alpha = 0.2, show.legend = FALSE, 
               outlier.shape = NA,
               position = position_nudge(x = -rain_height*2)) +
  facet_wrap(~factor(firma, 
                     levels = c("forsa", "bilendi"), 
                     labels = c("Forsa", "Bilendi")), 
             nrow = 2) +
  stat_summary(fun.data = mean_cl_normal, mapping = aes(color = condition2.english), show.legend = FALSE,
               position = position_nudge(x = rain_height * 3)) +
  scale_x_discrete(name = "", expand = c(rain_height*3, 0, 0, 0.7)) +
  coord_flip() +
  scale_fill_manual(values = c("#00429d", "#ff9408"), 
                    name = "Question type")+
  scale_color_manual(values = c("#00429d", "#ff9408"))+
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
        legend.position = c(0.8, 0.5),
        legend.background = element_rect(fill = "white", color = "white"))+
  labs(y = "Length of the answer (number of characters)")+
  theme(axis.text.x = element_text(size = 10),  
        axis.text.y = element_text(size = 14),
        strip.text = element_text(size = 14),
        legend.text = element_text(size = 12),  
        legend.title = element_text(size = 14)) 

y_position.task <- 350
y_position.title <- 350
y_position.bilendi <- 350
y_position.forsa <- 350

annotation_data1 <- data.frame(firma = c("forsa", "bilendi"), 
                               x = c(1.15, 1.15), # Choose an appropriate x position 
                               y = c(y_position.bilendi, y_position.forsa), 
                               label = c(summary_message.forsa4142,summary_message.bilendi4142))

annotation_data2 <- data.frame(firma = c("forsa", "bilendi"), 
                               x = c(1, 1), # Choose an appropriate x position 
                               y = c(y_position.task, y_position.title), 
                               label = c(summary_message.bil.mwu,summary_message.forsa.mwu))


p.length.q2 <- p + 
  geom_text(data = annotation_data1, aes(label = label, x = x, y = y), 
            inherit.aes = FALSE, 
            vjust = -1, size = 5)+
  geom_text(data = annotation_data2, aes(label = label, x = x, y = y), 
            inherit.aes = FALSE, 
            vjust = -1, size = 5)

p.length.q2

ggsave(file="output/figure4.jpeg", 
       plot=p.length.q2, 
       height = 5, width = 8, dpi = 300)

ggsave(file="output/figure4.svg", 
       plot=p.length.q2, 
       height = 5, width = 8, dpi = 300)


############################################################ here we classify words


#### type of words

q2.type.words <- dataset.complete %>%
  dplyr::filter(!is.na(char.count_answer2)) %>%
  dplyr::select(firma, condition2.english, cond2.noun: `cond2.ends with -ung, -heit, -keit, -nis, -schaft`)

library(tidyr)

data_long <- pivot_longer(q2.type.words, cols = c(-firma, -condition2.english), 
                          names_to = "Variable", values_to = "Value")
data_long <- data_long %>%
  mutate(Variable = case_when(
    Variable == "cond2.ends with -mann, -frau, -er, -erin, -in, -eur, -e, -ist, -wirt" ~ "OccupationTitle",
    Variable == "cond2.ends with -ung, -heit, -keit, -nis, -schaft" ~ "DerivedNouns",
    Variable == "cond2.noun" ~ "Nouns",
    Variable == "cond2.stopwords" ~ "StopWords",
    Variable == "cond2.verb" ~ "Verbs",
    Variable == "cond2.adjective" ~ "Adjectives",
    TRUE ~ Variable
  )) %>%
  mutate(Variable = factor(Variable, 
                           levels = rev(c("Nouns", "StopWords", 
                                          "Verbs", "DerivedNouns", 
                                          "Adjectives", "OccupationTitle")))) %>%
  mutate(condition2.english=factor(condition2.english, 
                                 levels=c("no example", "example")))

data_long_summary <- data_long %>%
  group_by(Variable, condition2.english, firma) %>%
  summarise(count = mean(Value, na.rm = TRUE), .groups = 'drop') 

data_long_summary$condition2.english <- 
  factor(data_long_summary$condition2.english , 
         levels = rev(levels(data_long_summary$condition2.english)))


figure5<-ggplot(data = data_long_summary, aes(x = Variable, y = count, fill = condition2.english)) +
  geom_bar(position = 'dodge', stat='identity', alpha=0.8) +
  geom_text(aes(label=round(count, 1), color = condition2.english), position=position_dodge(width=0.9), hjust=-0.25, size=3) +
  scale_fill_manual(values = c("#00429d", "#ff9408"), 
                    name = "Question type") +       
  scale_color_manual(values = c("#00429d", "#ff9408"), 
                     guide = "none") +
  theme_minimal() +
  coord_flip() +
  labs(x = "Type of the answer",
       y = "Average number of words of a given type in the answer") +
  facet_wrap(~factor(firma, 
                     levels = c("forsa", "bilendi"), 
                     labels = c("Forsa", "Bilendi")), 
             nrow = 1) +
  scale_y_continuous(limits = c(0, 5.5))+
  theme(axis.text.x = element_text(size = 8),  # Set the size for the x-axis labels
        axis.text.y = element_text(size = 14))  # S

ggsave(file="output/figure5.jpeg", 
       plot=figure5, 
       height = 5, width = 8, dpi = 300)

ggsave(file="output/figure5.svg", 
       plot=figure5, 
       height = 5, width = 8, dpi = 300)


############################ some examples for the appendix fig 2a:

#Because it also relies on actual dataset containing open-ended answers, we can not put it in the public domain

library(quanteda)
library("quanteda.textplots")
library("quanteda.textstats")
for.corpus<- dataset.complete %>% 
  filter(!is.na(char.count_answer2)) %>%
  select(answer.condition2, answer.condition1, condition2.english,firma)

corp_q2 <- corpus(for.corpus, text_field="answer.condition2", 
                  docvars=c("answer.condition1","condition2.english", "firma")) 
summary(corp_q2)

corpus_subset(corp_q2, firma="forsa") |>
  tokens(remove_punct = TRUE) |>
  tokens_remove(stopwords("german")) |>
  tokens_remove(c("arbeite", "Ich", "ich", "dafür", "sowie")) %>%
  dfm() |>
  dfm_group(groups = condition2.short) |>
  dfm_trim(min_termfreq = 10, verbose = FALSE) |>
  textplot_wordcloud(comparison = TRUE)                  


# Only select forsa
corp_forsa <- corpus_subset(corp_q2, firma=="forsa")
dfmat_pres <- tokens(corp_forsa, remove_punct = TRUE) |>
  tokens(remove_punct = TRUE) |>
  tokens_remove(stopwords("german")) |>
  tokens_remove(c("arbeite", "Ich", "ich", "dafür", "deren", "etc", "innen", "tätig", "bin")) %>%
  tokens_group(groups = condition2.english) |>
  dfm() %>%
  dfm_weight(scheme = "prop")

corp_bilendi <- corpus_subset(corp_q2, firma=="bilendi")
dfmat_pres2 <- tokens(corp_bilendi, remove_punct = TRUE) |>
  tokens(remove_punct = TRUE) |>
  tokens_remove(stopwords("german")) |>
  tokens_remove(c("arbeite", "Ich", "ich", "dafür", "deren", "etc", "innen", "tätig", "bin")) %>%
  tokens_group(groups = condition2.english) |>
  dfm() %>%
  dfm_weight(scheme = "prop")

dat_freq_weight <- textstat_frequency(dfmat_pres, n = 10, 
                                      groups = condition2.english)
dat_freq_weight$firma<- "forsa"

dat_freq_weight2 <- textstat_frequency(dfmat_pres2, n = 10, 
                                       groups = condition2.english)
dat_freq_weight2$firma<- "bilendi"

dat_freq_weight<-rbind(dat_freq_weight, dat_freq_weight2)

dat_freq_weight<- dat_freq_weight %>%
  mutate(translated = case_when(
    feature == "kunden" ~ "customers",
    feature == "zuständig" ~ "responsible",
    feature == "aufgaben" ~ "tasks",
    feature == "bearbeite" ~ "work on",
    feature == "bereich" ~ "field",
    feature == "unternehmen" ~ "companies",
    feature == "erstelle" ~ "create",
    feature == "führe" ~ "manage",
    feature == "beratung" ~ "consulting",
    feature == "unterrichte" ~ "teach",
    feature == "leite" ~ "lead",
    feature == "kinder" ~ "children",
    feature == "organisiere" ~ "organise",
    feature == "wartung" ~ "maintenance",
    feature == "organisation" ~ "organisation",
    feature == "bürotätigkeit" ~ "office work",
    feature == "menschen" ~ "people",
    feature == "dienst" ~ "service",
    feature == "mache" ~ "make",
    feature == "schreibe" ~ "write",
    feature == "dokumentation" ~ "documentation",
    feature == "verkauf" ~ "sale",
    feature == "ware" ~ "goods",
    feature == "einkauf" ~ "purchase",
    feature == "firma" ~ "firm",
    TRUE ~ feature
  ))

fig2a<- ggplot(data = dat_freq_weight, aes(x = nrow(dat_freq_weight):1, y = frequency)) +
  geom_point(color = "#00429d") +
  facet_wrap(firma~group, scales = "free") +
  scale_x_continuous(breaks = nrow(dat_freq_weight):1,
                     labels = dat_freq_weight$translated) +
  
  coord_flip() +
  labs(x = NULL, y = "Relative frequency of words")+
  theme_minimal()+
  theme(axis.text.x = element_text(size = 8),  # Set the size for the x-axis labels
        axis.text.y = element_text(size = 14))  # S


ggsave(file="output/fig2a.jpeg", 
       plot=fig2a, 
       height = 5, width = 8, dpi = 300)

ggsave(file="output/fig2a.svg", 
       plot=fig2a, 
       height = 5, width = 8, dpi = 300)



##############################################################################
############################ TTR ratio for the question with example or no example
#THis part of the code relies on calculating actual tockens, and can not be executed without verbatims, that we can not include in a public dataset due to privacy
# We however provide results of the analysis where possible

german_stopwords <- c(stopwords::stopwords("german"), "ich", "bin", "Ich", "arbeite","&","sowie","etc", "unsere","An","dienen", "eigenen",
                      "b", "z","Des","unseren","unserem", "ca", "Es", "ganze", "wer","Der", "In", "de", "Auch", "Vor", "ab","-","Zu", "Wir","and", "bzw", 
                      "")
calculate_ttr <- function(sample_data) {
  sample_data <- tolower(sample_data)
  sample_data <- gsub("[[:punct:]0-9]+", "", sample_data)
  tokens <- unlist(strsplit(sample_data, "\\s+"))
  tokens <- tokens[tokens != "" & !(tokens %in% german_stopwords)]
  stemmed_tokens <- wordStem(tokens, language = "german")
  unique_words <- length(unique(stemmed_tokens))
  total_words <- length(stemmed_tokens)
  return(unique_words / total_words)
}

ttr2<-dataset.complete %>%
  filter(!is.na(char.count_answer2))

calculate_ttr(ttr2$answer.condition2[ttr2$firma=="forsa" 
                                            & ttr2$condition2.english=="example"])
calculate_ttr(ttr2$answer.condition2[ttr2$firma=="forsa" & 
                                       ttr2$condition2.english=="no example"])
calculate_ttr(ttr2$answer.condition2[ttr2$firma=="bilendi" 
                                     & ttr2$condition2.english=="example"])
calculate_ttr(ttr2$answer.condition2[ttr2$firma=="bilendi" & 
                                       ttr2$condition2.english=="no example"])

# Function to calculate the difference in TTR between two groups
ttr_difference <- function(data, indices) {
  group1_indices <- indices[data$group[indices] == 1]
  group2_indices <- indices[data$group[indices] == 2]
  group1_sample <- data$word_list[group1_indices]
  group2_sample <- data$word_list[group2_indices]
  group1_text <- paste(group1_sample, collapse = " ")
  group2_text <- paste(group2_sample, collapse = " ")
  #print(group1_text)
  #print(group2_text)
  ttr1 <- calculate_ttr(group1_text)
  ttr2 <- calculate_ttr(group2_text)
  return(ttr2 - ttr1)
}

# Prepare and perform the bootstrap
perform_bootstrap <- function(df, firm_name) {
  group1_words <- df$answer.condition2[df$firma == firm_name & df$condition2.english == "no example"]
  group2_words <- df$answer.condition2[df$firma == firm_name & df$condition2.english == "example"]
  all_words <- c(group1_words, group2_words)
  group_indicator <- c(rep(1, length(group1_words)), rep(2, length(group2_words)))
  data_frame <- data.frame(word_list = all_words, group = group_indicator)
  set.seed(123)  # For reproducibility
  boot_results <- boot(data_frame, statistic = ttr_difference, R = 1000, parallel = "no", stype = "i")
  return(boot_results)
}

bootstrap_results_forsa <- perform_bootstrap(ttr2, "forsa")
bootstrap_results_forsa
# 
# Call:
#   boot(data = data_frame, statistic = ttr_difference, R = 1000, 
#        stype = "i", parallel = "no")
# Bootstrap Statistics :
#   original     bias    std. error
# t1* -0.06282195 0.01904484  0.04833246

bootstrap_results_bilendi <- perform_bootstrap(ttr2, "bilendi")
bootstrap_results_bilendi
# ORDINARY NONPARAMETRIC BOOTSTRAP
# Call:
#   boot(data = data_frame, statistic = ttr_difference, R = 1000, 
#        stype = "i", parallel = "no")
# Bootstrap Statistics :
#   original      bias    std. error
# t1* -0.01164584 0.002314727  0.04653679

# Extract the bootstrap estimates
bootstrap_estimates_forsa <- bootstrap_results_forsa$t
bootstrap_estimates_bilendi <- bootstrap_results_bilendi$t
# Calculate the confidence interval
boot.ci(bootstrap_results_forsa, type = "perc")
boot.ci(bootstrap_results_bilendi, type = "perc")
# Calculate 95% confidence intervals using the percentile method
ci_forsa <- boot.ci(bootstrap_results_forsa, type = "perc")
ci_bilendi <- boot.ci(bootstrap_results_bilendi, type = "perc")

# Extract lower and upper bounds
lower_ci_forsa <- ci_forsa$perc[4]
upper_ci_forsa <- ci_forsa$perc[5]
lower_ci_bilendi <- ci_bilendi$perc[4]
upper_ci_bilendi <- ci_bilendi$perc[5]


# Prepare data for plotting
data_plot <- data.frame(
  estimate = c(bootstrap_estimates_forsa, bootstrap_estimates_bilendi),
  firm = factor(rep(c("Forsa", "Bilendi"), each = 1000))
)

TTR.condition2<-ggplot(data_plot, aes(x = estimate, fill = firm)) +
  geom_histogram(binwidth = 0.003, color = "#828182", alpha=1) +
  # custom colours and theme
  scale_fill_manual(values = c("#E2B6CC", "#709A86"), 
                    name = "Agency")+
  scale_color_manual(values = c("#E2B6CC", "#709A86"))+
  theme_minimal() +
  theme(panel.grid.major.y = element_blank(),
        legend.position = c(0.9, 0.4),
        legend.background = element_rect(fill = "white", color = "white"))+
  labs(y = "")+
  facet_wrap(~ firm, nrow=2) +
  geom_vline(data = data.frame(firm = "Forsa", xintercept = c(lower_ci_forsa, upper_ci_forsa)),
             aes(xintercept = xintercept), linetype = "dashed", color = "red") +
  geom_vline(data = data.frame(firm = "Bilendi", xintercept = c(lower_ci_bilendi, upper_ci_bilendi)),
             aes(xintercept = xintercept), linetype = "dashed", color = "red") +
  labs(title = "",
       x = "Bootstrapped difference in TTR between responses with example and without example",
       y = "Frequency")+
  theme(axis.text.x = element_text(size = 8),  # Set the size for the x-axis labels
        axis.text.y = element_text(size = 8))  # S

ggsave(file="output/bootstrap.condition2.jpeg", 
       plot=TTR.condition2, 
       height = 5, width = 8, dpi = 300)

ggsave(file="output/bootstrap.condition2.svg", 
       plot=TTR.condition2, 
       height = 5, width = 8, dpi = 300)


